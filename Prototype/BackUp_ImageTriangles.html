<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logic_Tester</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <video id="background-video" autoplay loop muted>
        <source src="videos/LandScape.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three/build/three.module.js",
                "three/addons/": "https://unpkg.com/three/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { TrackballControls } from 'three/addons/controls/TrackballControls.js';

        let scene, camera, renderer, controls, icosahedron;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let isRotating = true;
        let materials = [];

        const links = [
            'test.html', 'test.html', 'test.html', 'test.html',
            'test.html', 'test.html', 'test.html', 'test.html',
            'test.html', 'test.html', 'test.html', 'test.html',
            'test.html', 'test.html', 'test.html', 'test.html',
            'test.html', 'test.html', 'test.html', 'test.html',
        ]; // 페이지 URL 링크

        init();
        animate();

        function init() {
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.z = 8;

            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            controls = new TrackballControls(camera, renderer.domElement);
            controls.mouseButtons = {
                LEFT: THREE.MOUSE.ROTATE,
                MIDDLE: THREE.MOUSE.DOLLY,
                RIGHT: null
            };
            controls.minDistance = 4;
            controls.maxDistance = 8;

            controls.addEventListener('start', () => isRotating = false);
            controls.addEventListener('end', () => isRotating = true);

            const images = [
                'images/HHH.jpg',
                'images/Hwa.jpg',
                'images/Go.jpeg',
                'images/Hwa.jpg',
                'images/city3.jpg',
                'images/Hwa.jpg',
                'images/city3.jpg',
                'images/Hwa.jpg',
                'images/city3.jpg',
                'images/Hwa.jpg',
                'images/city3.jpg',
                'images/Hwa.jpg',
                'images/city3.jpg',
                'images/Hwa.jpg',
                'images/city3.jpg',
                'images/Hwa.jpg',
                'images/city3.jpg',
                'images/Hwa.jpg',
                'images/city3.jpg',
                'images/Hwa.jpg',
            ];

            const loader = new THREE.TextureLoader();
            let loadedCount = 0;

            images.forEach((image, index) => {
                loader.load(image, (texture) => {
                    // 패딩을 추가한 텍스처 생성
                    const paddedTexture = createPaddedTexture(texture.image);
                    const material = new THREE.MeshBasicMaterial({ map: paddedTexture, transparent: false });
                    materials[index] = material;
                    loadedCount++;
                    if (loadedCount === images.length) {
                        createIcosahedron();
                        fadeInIcosahedron();
                    }
                });
            });

            window.addEventListener('resize', onWindowResize);
            document.addEventListener('dblclick', onDoubleClick, false);
        }

        function createPaddedTexture(image) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            const padding = 50; // 패딩 크기 설정

            // 캔버스 크기 설정
            canvas.width = image.width + padding * 2;
            canvas.height = image.height + padding * 2;

            // 패딩 영역을 흰색으로 설정
            context.fillStyle = 'white';
            context.fillRect(0, 0, canvas.width, canvas.height);

            // 이미지를 캔버스 가운데에 그림
            context.drawImage(image, padding, padding, image.width, image.height);

            // 새로운 텍스처 생성
            const texture = new THREE.Texture(canvas);
            texture.needsUpdate = true;

            return texture;
        }

        function createIcosahedron() {
            const geometry = new THREE.IcosahedronGeometry(2, 0);

            const materialGroups = [];
            for (let i = 0; i < 20; i++) {
                const materialIndex = i % materials.length;
                materialGroups.push({ start: i * 3, count: 3, materialIndex: materialIndex });
            }

            geometry.clearGroups();
            materialGroups.forEach(group => {
                geometry.addGroup(group.start, group.count, group.materialIndex);
            });

            // 텍스처 좌표 설정
            const uvs = [];
            for (let i = 0; i < 20; i++) {
                uvs.push(0.5, 1);   // 위쪽 꼭짓점
                uvs.push(0, 0);     // 왼쪽 아래 꼭짓점
                uvs.push(1, 0);     // 오른쪽 아래 꼭짓점
            }
            geometry.setAttribute('uv', new THREE.Float32BufferAttribute(uvs, 2));

            icosahedron = new THREE.Mesh(geometry, materials);
            scene.add(icosahedron);
        }

        function fadeInIcosahedron() {
            materials.forEach((material) => {
                new TWEEN.Tween(material)
                    .to({ opacity: 1 }, 2000)
                    .easing(TWEEN.Easing.Quadratic.Out)
                    .start();
            });
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onDoubleClick(event) {
            event.preventDefault();

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(icosahedron);

            if (intersects.length > 0) {
                const faceIndex = Math.floor(intersects[0].faceIndex / 3);
                alert(`Double-clicked on icosahedron's face: ${faceIndex}`);
                const originalColor = icosahedron.material[faceIndex].color.clone();
                icosahedron.material[faceIndex].color.set(0xaeaeae);

                setTimeout(() => {
                    icosahedron.material[faceIndex].color.copy(originalColor);
                }, 100);

                window.location.href = links[faceIndex];
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            if (isRotating && icosahedron) {
                icosahedron.rotation.x += 0.01;
                icosahedron.rotation.y += 0.01;
            }
            controls.update();
            TWEEN.update();
            renderer.render(scene, camera);
        }
    </script>
    <header>
        <h1>Romantic Gangwon, Lovely Gangwon</h1>
        <nav>
            <a href="#">Home</a>
            <a href="#">About</a>
            <a href="#">Contact</a>
        </nav>
    </header>
    <footer>
        <p>&copy; 2024 SeanKim. All rights reserved.</p>
        <p>Contact: coreiu0210@gmail.com</p>
    </footer>
</body>
</html>
